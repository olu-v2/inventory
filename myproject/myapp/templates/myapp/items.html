{% extends "myapp/base.html" %} {% load static %} {% block content %}

<div class="max-w-3xl mx-auto py-10">
  <h2 class="text-3xl font-bold mb-6 text-gray-800">Inventory Items</h2>

  {% if error %}
  <p class="mb-4 text-red-500 font-medium">{{ error }}</p>
  {% endif %}

  <!-- ITEMS LIST -->
  <h3 class="text-2xl font-semibold mb-4 text-gray-700">Current Inventory</h3>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% for item in items %}
    <div class="bg-white border border-gray-200 rounded-lg shadow p-4">
      <div class="flex items-center space-x-4">
        <img
          src="{{ item.image_url }}"
          alt="{{ item.name }}"
          class="w-20 h-20 object-cover rounded-md border"
        />
        <div>
          <p class="text-lg font-semibold text-gray-800">{{ item.name }}</p>
          <p class="text-gray-600">Quantity: {{ item.quantity }}</p>
          <p class="text-gray-500 text-sm">{{ item.tag }}</p>
        </div>
      </div>

      <!-- ACTION BUTTONS -->
      <div class="mt-4 flex space-x-3">
        <!-- CHECKOUT BUTTON -->
        <form id="checkoutForm">
          <input type="hidden" id="itemId" value="{{ item.id }}" />
          <button
            type="submit"
            class="px-4 py-2 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition"
          >
            Checkout
          </button>
        </form>
        <script>
          document
            .getElementById("checkoutForm")
            .addEventListener("submit", async (e) => {
              e.preventDefault();

              const itemId = document.getElementById("itemId").value;

              const data = [
                {
                  item_id: itemId,
                  quantity: 1,
                },
              ];

              const response = await fetch("{% url 'checkout' %}", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-CSRFToken": "{{ csrf_token }}",
                },
                body: JSON.stringify(data),
              });

              const result = await response.json();
              console.log(result);
            });
        </script>

        <!-- DELETE BUTTON -->
        <form action="{% url 'items' %}" method="POST">
          {% csrf_token %}
          <input type="hidden" name="_method" value="DELETE" />
          <input type="hidden" name="item_id" value="{{ item.id }}" />
          <input type="hidden" name="item_tag" value="{{ item.tag }}" />
          <button
            type="submit"
            class="px-4 py-2 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700 transition"
          >
            Delete
          </button>
        </form>
      </div>
    </div>
    {% empty %}
    <p class="text-gray-500">No items found.</p>
    {% endfor %}
  </div>
</div>

{% endblock %}
